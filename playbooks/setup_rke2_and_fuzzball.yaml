---

- name: NFS export from admin for Substrate configuration
  hosts: fuzzball_nfs_server
  roles:
  - ciq.fuzzball.nfs_server

- name: Deploy Fuzzball Orchestrate on a new RKE2 cluster
  hosts: fuzzball_controller
  pre_tasks:
  - name: Install python3-kubernetes for Ansible to use
    ansible.builtin.package:
      name: python3-kubernetes
      state: present
  roles:
  - ciq.fuzzball.mountain
  - ciq.fuzzball.rke2
  - ciq.fuzzball.metallb
  - ciq.fuzzball.local_path_provisioner
  - ciq.fuzzball.helm
  - ciq.fuzzball.fuzzball_operator
  - ciq.fuzzball.fuzzball_orchestrate

- name: Deploy the Fuzzball CLI on controllers
  hosts: fuzzball_controller
  roles:
  - ciq.fuzzball.fuzzball_cli

- name: Install Fuzzball Substrate on compute nodes
  hosts: fuzzball_compute
  roles:
  - ciq.fuzzball.mountain
  - ciq.fuzzball.nfs_client
  - ciq.fuzzball.fuzzball_substrate
